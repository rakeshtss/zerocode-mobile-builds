(window.webpackJsonp=window.webpackJsonp||[]).push([[18,54],{"/oWr":function(t,e){t.exports=""},"3Zpb":function(t,e,s){"use strict";s.r(e);var i=s("D57K"),a=s("LoAr"),n=s("05nE"),r=s("981U"),o=s("GiBk"),c=s("Jg5f"),u=function(){function t(t){this.http=t,this.currentStage={}}return t.prototype.getStageList=function(t,e,s,i){var a=this;return void 0===i&&(i=!1),this.http.post(t,e).pipe(Object(c.a)(function(t){var e=[];if(t&&t.data&&t.data.stageWidget&&t.data.stageWidget.config&&t.data.stageWidget.config.stages){var n=t.data.stageWidget.config.stages;a.currentStage=t.data.stage;var r=t.data.status;if(n&&i){if(a.currentStage)for(var o=function(t){var i=n[t];if(s){var o=s.find(function(t){return t.stage.code===i.info.code});o&&o.history&&o.history[0]&&(i.historyInfo=o.history[0])}if(i.info.index=t+1,i.info.code===a.currentStage.code)return i.status=r,i.activeStatus=!0,e.push(i),"break";e.push(i)},c=0;c<n.length;c++){if("break"===o(c))break}else e.push(n[0]);e.reverse()}else e=n}return e}))},t.prototype.getFaStageList=function(t,e,s,i){var a=this;return void 0===i&&(i=!1),this.http.post(t,e).pipe(Object(c.a)(function(t){var e=[];if(t&&t.data&&t.data.stageWidget&&t.data.stageWidget.config&&t.data.stageWidget.config.stages){var n=t.data.stageWidget.config.stages;a.currentStage=t.data.stage;var r=t.data.status;if(n&&i)if(a.currentStage)for(var o=function(t){var i=n[t];if(s){var o=s.find(function(t){return t.stage.code===i.info.code});o&&o.history&&o.history[0]&&(i.historyInfo=o.history[0])}i.info.index=t+1,i.info.code===a.currentStage.code?(i.status=r,i.activeStatus=!0,e.push(i)):e.push(i)},c=0;c<n.length;c++)o(c);else e.push(n[0]);else e=n}return e}))},t.prototype.getCurrentStage=function(){return this.currentStage},t=i.c([Object(a.Injectable)({providedIn:"root"}),i.f("design:paramtypes",[n.c])],t)}(),g=function(){function t(t,e,s,i,a,n,r){this.http=t,this.actionService=e,this.unsavedDataAlertService=s,this.qlanaStageService=i,this.httpCache=a,this.route=n,this.router=r,this.stageList=[],this.currentStageIndex=0}return t.prototype.ngOnInit=function(){this.getStageList()},t.prototype.paramsSubscribe=function(){var t=this;this.paramsSubscribe$=this.route.queryParams.subscribe(function(e){t.queryPrams=e,t.queryPrams.page&&t.loadPage(t.queryPrams.page),t.currentStageIndex=t.getCurrentIndex()})},t.prototype.getStageList=function(){var t=this;this.stageList=[];var e=this.route.snapshot.params,s=(this.route.snapshot.queryParams,this.actionService.getParams(this.options.api.params,e));this.qlanaStageService.getStageList(this.options.api.url,s,null,this.options.isWorkflow).subscribe(function(e){e&&(e.forEach(function(e){if(console.log("stagedd",e),e.activeStatus){var s={info:e.info,status:e.status};zc.params=i.a({},zc.params,{activeStage:s})}e.sections.forEach(function(s){s.subSections.forEach(function(i){var a={};a.stage=e.info.code,a.section=s.info.code,a.subSection=i.info.code,a.page=i.info.page,a.data=i,t.stageList.push(a)})})}),t.paramsSubscribe())})},t.prototype.loadPage=function(t){var e=this,s=new o.HttpHeaders;this.httpCache.clearCache(),s=s.append("page",this.queryPrams.page),this.pageInfo=null,this.http.get("page/_/_/"+t).subscribe(function(t){if(t.data.instructions.definition&&t.data.instructions.definition&&(t.data.instructions.definition.widgets&&(e.pageInfo=t.data.instructions.definition.widgets),t.data.instructions.definition.onLoad&&t.data.instructions.definition.onLoad.actions)){var s=t.data.instructions.definition.onLoad.actions;s.length>0&&s.forEach(function(t){e.actionService.action(t)})}},function(t){}),this.setCurrentStage()},t.prototype.next=function(){var t=this;this.unsavedDataAlertService.alertMsg().then(function(e){if(console.log("alertMsg dfs",e),e){var s=t.getCurrentIndex(),i=t.stageList[s+1].page,a=t.stageList[s+1].stage;t.navigateUrl(i,a)}})},t.prototype.previous=function(){var t=this;this.unsavedDataAlertService.alertMsg().then(function(e){console.log("alertMsg dfs",e);var s=t.getCurrentIndex();if(0!==s){var i=t.stageList[s-1].page,a=t.stageList[s-1].stage;t.navigateUrl(i,a)}})},t.prototype.setCurrentStage=function(){var t={name:"stageWidget",meta:this.stageList[this.getCurrentIndex()]},e=JSON.parse(JSON.stringify(t)),s=e.meta.data;delete e.meta.data,zc.params=i.a({},zc.params,{currentStage:e,currentStageMetaData:s})},t.prototype.getCurrentIndex=function(){var t=this;return this.stageList.indexOf(this.stageList.find(function(e){return e.stage===t.queryPrams.stage&&e.page===t.queryPrams.page}))},t.prototype.navigateUrl=function(t,e){this.router.navigate([],{queryParams:{page:t,stage:e}})},t.prototype.ngOnDestroy=function(){this.paramsSubscribe$&&this.paramsSubscribe$.unsubscribe()},i.c([Object(a.Input)(),i.f("design:type",Object)],t.prototype,"options",void 0),t=i.c([Object(a.Component)({selector:"zc-qlana-stage-view",template:s("MAkz"),styles:[s("/oWr")]}),i.f("design:paramtypes",[n.c,n.a,n.l,u,n.g,r.ActivatedRoute,r.Router])],t)}(),p=s("DUHm"),d=s("G2Mx"),f=function(){function t(t,e,s,i,a,n){this.http=t,this.actionService=e,this.qlanaStageService=s,this.zcWorkflowHistory=i,this.router=a,this.route=n,this.showStage=!1}return t.prototype.ngOnInit=function(){this.showStage=!1,this.params=this.route.snapshot.params,this.getStageList()},t.prototype.timeTakenDays=function(t){var e=this.qlanaStageService.getCurrentStage(),s="",i="";(s=t.created?new Date(t.created):new Date).setHours(0,0,0,0),(i=t.last_modified&&e.code!==t.code?new Date(t.last_modified):new Date).setHours(0,0,0,0);var a=Math.abs(i.getTime()-s.getTime());return Math.ceil(a/864e5)},t.prototype.getStageList=function(){var t=this,e=this.actionService.getParams(this.options.api.params,this.params);if(this.options.isWorkflow){this.showStage=!0;var s={entity:this.options.entity,uid:this.route.snapshot.params.uid};this.zcWorkflowHistory.getHistoryByStageGroup(s).subscribe(function(s){console.log("historyList",s),t.stageList$=t.qlanaStageService.getStageList(t.options.api.url,e,s,!0).pipe(Object(d.a)(1),Object(c.a)(function(t){return t}))}),console.log("this.stageList$ --\x3e",this.stageList$)}else this.stageList$=this.qlanaStageService.getStageList(this.options.api.url,e).pipe(Object(d.a)(1),Object(c.a)(function(e){return console.log("stage",e),e.length>1&&(t.showStage=!0),e}));console.log("this.stageList$",this.stageList$)},t.prototype.ngOnDestroy=function(){},i.c([Object(a.Input)(),i.f("design:type",Object)],t.prototype,"options",void 0),t=i.c([Object(a.Component)({selector:"zc-qlana-stage-list",template:s("Lv0o"),styles:[s("jNf5")]}),i.f("design:paramtypes",[n.c,n.a,u,p.a,r.Router,r.ActivatedRoute])],t)}(),l=s("7++q"),h=s("eQXH");s.d(e,"ClientsQlanaModule",function(){return v});var v=function(){function t(){}return t=i.c([Object(a.NgModule)({imports:[h.a,l.ZcWorkflowModule],declarations:[g,f],exports:[g,f]})],t)}()},Lv0o:function(t,e){t.exports='<div class="list-view-main">\r\n  <div class="list-view-str"> </div>\r\n</div>\r\n<div class="list-view-main">\r\n\r\n  <ng-container *ngFor=\'let stage of stageList$ | async;let inx=index;\'>\r\n    <div *ngIf="showStage"   class="list-bgheader-view mt-3" [ngStyle]="{\'background-color\':\'#5e74b0\'}">\r\n      <div class="list-header-view list-icon-view">\r\n        <h3> <span class="num-count">{{stage.info.index || inx+1}}</span>\r\n          <div class="list-header-title">\r\n            <span>{{stage?.info?.title}}</span>\r\n            \x3c!-- <p class="mb0 pl35 ml5 text-capitalize f10 font-italic" *ngIf="stage.historyInfo"><span>Initiated by relationship\r\n                Officer Test on </span><span>Apr 25, 2019</span> </p> --\x3e\r\n          </div>\r\n        </h3>\r\n        <ul class="">\r\n          <li *ngIf="stage?.historyInfo">\r\n            <div class="status-btn"><label>Status</label>\r\n              <p><button class="btn btn-sm btn-success">{{stage?.historyInfo?.to?.status?.name || stage?.historyInfo?.from?.status?.name}}</button></p>\r\n            </div>\r\n          </li>\r\n          <li>\r\n            <a [routerLink]="[\'/qlana/project/project-complete-view\',params.uid]"\r\n              [queryParams]="{stage: stage.info.code,currentStage:(inx===0)?\'true\':\'false\'}" class="icon-eye"></a>\r\n            \x3c!-- <a  [routerLink]="[\'/qlana/project/project-complete-view\']"  [queryParams]="{stage: stage.info.code}" class="icon-eye"></a></li> --\x3e\r\n        </ul>\r\n      </div>\r\n      <div class="list-bottomheader-view">\r\n        <p *ngIf="stage?.historyInfo">Last\r\n          updated by {{stage?.historyInfo?.from?.user?.first_name}} on {{stage?.historyInfo?.received_date_time | date}}\r\n        </p>\r\n        <p>Time Taken: {{timeTakenDays(stage.info)}} Days</p>\r\n      </div>\r\n    </div>\r\n    <div class="list-view-str">\r\n      <ul class="clearfix">\r\n        <li *ngFor=\'let section of stage.sections\'>\r\n          <div class="list-str">\r\n            <h4>\r\n              {{section.info.title}}\r\n            </h4>\r\n            \x3c!-- href="/#/qlana/{{moduleType}}/{{moduleType}}-stage-view/{{params.uid}}?page={{subsection.code}}&pageName={{subsection.name}}" --\x3e\r\n            <a [routerLink]="[\'/\'+options.page.url,params.uid]"\r\n              [queryParams]="{page: subsection.info.page,stage:stage.info.code}"\r\n              *ngFor=\'let subsection of section.subSections\' class="list-data white-bg"\r\n              [ngClass]="{\'draft-active\': (subsection && subsection.meta && subsection.meta.action===\'Draft\'),\'submit-active\': (subsection && subsection.meta && subsection.meta.action===\'Submit\')}">\r\n              <div class="list-img"> <i [ngClass]="subsection.info.icon"></i> </div>\r\n              <div class="list-text">\r\n                <h5>{{subsection.info.title}}</h5>\r\n                <span *ngIf="subsection?.meta">{{subsection?.meta?.modified_user?.name}} -\r\n                  {{subsection?.meta?.modified_time | date:\'MMM d, y\'}}</span>\r\n              </div>\r\n            </a>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n\r\n    </div>\r\n  </ng-container>\r\n\r\n\r\n</div>'},MAkz:function(t,e){t.exports='<div *ngIf="stageList.length > 0" class="qlana-stage-next-previous text-right">\r\n  <button class="btn btn-primary btn-sm"  [disabled]=\'currentStageIndex===0\'  (click)="previous()"><i\r\n      class="icon-angle-left"></i></button>\r\n  <button class="btn btn-primary btn-sm ml-2"  [disabled]="currentStageIndex >= stageList.length-1" (click)="next()"><i\r\n      class="icon-angle-right"></i></button>\r\n</div>\r\n<div *ngIf="pageInfo">\r\n  <zc-page-render [options]="{ widgets: pageInfo }"></zc-page-render>\r\n</div>'},YfSF:function(t,e,s){"use strict";var i=s("Jg5f");s.d(e,"a",function(){return i.a})},jNf5:function(t,e){t.exports=""},vtXP:function(t,e,s){"use strict";var i=s("YfSF");s.d(e,"a",function(){return i.a})}}]);